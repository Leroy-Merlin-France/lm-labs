--- PageClasseur-bottom-js.ftl
+++ PageClasseur-bottom-js.ftl
@@ -2,4 +2,5 @@
     jQuery(document).ready(function() {
         // Select columns to sort
         jQuery("table[class*='classeurFiles']").tablesorter({
+<#if canWrite >
             sortList: [[2,0]],
@@ -5,4 +6,7 @@
             sortList: [[2,0]],
+<#else>
+            sortList: [[1,0]],
+</#if>
             headers: {
                 0: {
                     sorter:false
@@ -37,10 +41,20 @@
             jQuery(this).attr('action', decodeURIComponent(encoded.replace(/\+/g,  " ")));
         });
         <#list folders as folder>
-        jQuery("#form-upload-file-${folder.document.id}").ajaxForm(function() {
-            reloadAfterAddingFile("${folder.document.id}");
+        jQuery("#form-upload-file-${folder.document.id}").ajaxForm({
+            beforeSubmit: function(arr, $form, options) {
+                jQuery('#waitingPopup').find('div.bar').width('0%');
+                jQuery('#waitingPopup').dialog2('open');
+            },
+            uploadProgress: function(event, position, total, percentComplete) {
+                var percentVal = percentComplete + '%';
+                jQuery('#waitingPopup').find('div.bar').width(percentVal);
+            },
+            success: function() {
+                reloadAfterAddingFile("${folder.document.id}");
+            }
         });
         </#list>
     });
     
     function reloadAfterAddingFile(folderId) {
@@ -42,10 +56,8 @@
         });
         </#list>
     });
     
     function reloadAfterAddingFile(folderId) {
-        //jQuery("#addfile_"+folderId+"_modal").dialog2('close');
-        jQuery('#waitingPopup').dialog2('open');
         window.location.reload();
     }
     function updateBtLabels(bt, title, alt) {
@@ -93,8 +105,25 @@
             jQuery(imgObj).addClass('allFoldersOpened');
             changeFolderBt(imgObj, 'close');
             updateBtLabels(imgObj, "${Context.getMessage('label.PageClasseur.allFolders.collapse')}", "${Context.getMessage('command.PageClasseur.allFolders.collapse')}");
-                jQuery("img[class*='openCloseBt']").each(function(i, e) {
-                    slideFolder(jQuery(this), 'close');
-                });
+            jQuery("img[class*='openCloseBt']").each(function(i, e) {
+                slideFolder(jQuery(this), 'close');
+            });
+        }
+    }
+    function filesSelected(input) {
+        otherInputs = jQuery(input).closest('form').find('input[type=text],textarea').closest('div.control-group');
+        if (input.files.length > 1) {
+            otherInputs.hide();
+        } else {
+            otherInputs.show();
+        }
+        
+        var htmlStr = input.files.length + " fichiers (${This.maxNbrUploadFiles} fichiers maximum).\n";
+        htmlStr += "<ul>";
+        for (var x = 0; x < input.files.length; x++) {
+            if (x >= ${This.maxNbrUploadFiles}) {
+            } else {
+                htmlStr += "<li>" + input.files[x].name;
+                htmlStr += "</li>";
             }
         }
@@ -99,4 +128,8 @@
             }
         }
-
+        htmlStr += "</ul>";
+        var infoDiv = jQuery(input).closest('div.control-group').siblings('div.control-group').find('div.selectedFiles');
+        jQuery(infoDiv).html(htmlStr);
+        jQuery(infoDiv).closest('div.control-group').show();
+    }
 </script>
